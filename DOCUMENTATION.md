# Документация

## Создание пользователя и авторизация

Для создания пользователя необходимо сделать POST-запрос к эндпойнту /signup/, передав данные следующего вида:

```
{
    "first_name": "Anya",
    "last_name": "Kondrateva",
    "email": "anya@gmail.com",
    "password": "12345",
    "tz_offset": 10800
}
```

Для аутентификации необходимо сделать POST-запрос к эндпойнту /login/, передав логин и пароль в формате x-www-form-urlencoded:

```
{
    "username": "anya@gmail.com",
    "password": "12345"
}
```

В ответ вернется токен доступа:

```
{
    "access_token": "TOKEN12345",
    "token_type": "bearer"
}
```

В дальнейшем токен необходимо передавать в заголовке Authorization, чтобы получить доступ к остальным роутам.

## Создание встречи и получение информации о ней

### Создание встречи

Чтобы создать неповторяющуюся встречу, нужно сделать POST-запрос к роуту /events/ с данными следующего вида:

```
{
    "starts_at": "2022-06-01 20:00",
    "ends_at": "2022-06-01 21:00",
    "description": "Test meeting",
    "is_private": False,
    "is_recurrent": False
    "owner_id": 1,
    "participants": [2, 3]
}
```

Даты старта и начала передаются строкой в формате "%Y-%m-%d %H:%M". Участники и владелец встречи передаются с помощью ID пользователей календаря.

Чтобы создать повторяющуюся встречу, нужно передать параметр is_recurrent = True, а также передать строковый параметр recurrency_rule:

```
{
    "starts_at": "2022-06-01 20:00",
    "ends_at": "2022-06-01 21:00",
    "description": "Test meeting",
    "is_private": False,
    "is_recurrent": True
    "owner_id": 1,
    "participants": [2, 3],
    "recurrency_rule": "weekly | 0, 1, 3 | interval | 1"
}
```

### Как формировать правило реккурентности

Параметры в строке отделяются символом | и двумя пробелами. Сначала идет частота (daily, weekly, monthly, yearly), затем True в случае с частотами daily, monthly, yearly либо номера дней недели через запятую в случае с weekly.
Далее идет параметр interval, а после него - частота, с которой надо повторять встречи (раз в неделю, раз в две недели, etc).

По умолчанию параметр monthly работает как повторение для того же числа следующего месяца.

TODO: сделать повтор вида "каждую первую пятницу месяца" (не успела).

Другие примеры:

```
yearly | True | interval | 1
weekly | 0, 1, 5 | interval | 2
daily | True | interval | 3
monthly | True | interval | 1
```

### Получение встречи

Для получения информации о встрече необходимо сделать GET-запрос к роуту /events/*EVENT_ID*/. Если вы смотрите встречу другого пользователя, можно столкнуться с настройками приватности. Если встреча приватная, будет скрыт список участников, а вместо описания встреечи будет стоять "busy".

## Реакция на приглашение

Для того, чтобы принять или отклонить встречу, необходимо сделать PUT-запрос к роуту /invite/*INVITE_ID*/ с данными следующего вида:

```
{
    "is_accepted": bool
}
```

По умолчанию все инвайты считаются "непросмотренными" (то есть такими, которые не были эксплицитно приняты или отклонены). Они будут учитываться при поиске свободного слота в календаре и будут выводиться в списке общих встреч.

## Просмотр всех встреч во временном интервале

Чтобы просмотреть все свои или чужие встречи во временном интервале, нужно сделать GET-запрос к роуту /events/?user_id=*USER_ID*&from_time=*DATE_STRING*&to_time=*DATE_STRING*.

Даты старта и начала интервала передаются строкой в формате "%Y-%m-%d %H:%M".

В ответ возвращается список встреч, как тех, что были созданы пользователем, так и тех, на которые он был приглашен (и принял инвайт либо не отреагировал на него).

## Получение ближайшего свободного временного интервала в календарях нескольких пользователей

Чтобы получить эту информацию, нужно сделать GET-запрос к роуту /spots/?user=*USER_1_ID*&user=*USER_2_ID*&meeting_length=*MEETING_LENGTH*.

Длина интервала передается в **минутах**.
